{
  "description": "Digital Collections API V1-to-V2 Work Pipeline",
  "processors": [
    {
      "script": {
        "id": "v1-to-v2-original-ctx"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.abstract",
        "target_field": "abstract"
      }
    },
    {
      "rename": {
        "field": "original.accessionNumber",
        "target_field": "accession_number"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.alternateTitle",
        "target_field": "alternate_title"
      }
    },
    {
      "set": {
        "field": "api_model",
        "value": "Work"
      }
    },
    {
      "set": {
        "field": "api_link",
        "value": "[PLACEHOLDER]/{{original.id}}"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.ark",
        "target_field": "ark"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.boxName",
        "target_field": "box_name"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.boxNumber",
        "target_field": "box_number"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.caption",
        "target_field": "caption"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.catalogKey",
        "target_field": "catalog_key"
      }
    },
    {
      "rename": {
        "field": "original.collection",
        "target_field": "collection"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.contributor",
        "processor": {
          "append": {
            "field": "contributor",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}",
              "role": "{{_ingest._value.role.label}}",
              "label_with_role": "{{_ingest._value.term.label}} ({{_ingest._value.role.label}})"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.createDate",
        "target_field": "create_date"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.creator",
        "processor": {
          "append": {
            "field": "creator",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}"
            }
          }
        }
      }
    },
    {
      "script": {
        "id": "v1-to-v2-work-file-sets"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.folderName",
        "target_field": "folder_names"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.folderNumber",
        "target_field": "folder_numbers"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.genre",
        "processor": {
          "append": {
            "field": "genre",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.id",
        "target_field": "id"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.identifier",
        "target_field": "identifier"
      }
    },
    {
      "rename": {
        "field": "original.iiifManifest",
        "target_field": "iiif_manifest"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.keywords",
        "target_field": "keywords"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.legacyIdentifier",
        "target_field": "legacy_identifier"
      }
    },
    {
      "rename": {
        "field": "original.administrativeMetadata.libraryUnit.label",
        "target_field": "library_unit",
        "on_failure": [
          {
            "set": {
              "field": "library_unit",
              "value": ""
            }
          }
        ]
      }
    },
    {
      "remove": {
        "field": "library_unit.scheme",
        "ignore_missing": true
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.license",
        "target_field": "license"
      }
    },
    {
      "remove": {
        "field": "license.scheme",
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "original.modifiedDate",
        "target_field": "modified_date"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.notes",
        "processor": {
          "append": {
            "field": "notes",
            "value": {
              "text": "{{_ingest._value.note}}",
              "type": "{{_ingest._value.type.label}}"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.physicalDescriptionMaterial",
        "target_field": "physical_description_material"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.physicalDescriptionSize",
        "target_field": "physical_description_size"
      }
    },
    {
      "rename": {
        "field": "original.administrativeMetadata.preservationLevel.label",
        "target_field": "preservation_level",
        "on_failure": [
          {
            "set": {
              "field": "preservation_level",
              "value": ""
            }
          }
        ]
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.provenance",
        "target_field": "provenance"
      }
    },
    {
      "rename": {
        "field": "original.published",
        "target_field": "published"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.publisher",
        "target_field": "publisher"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.relatedMaterial",
        "target_field": "related_material"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.relatedUrl",
        "processor": {
          "append": {
            "field": "related_url",
            "value": {
              "url": "{{_ingest._value.url}}",
              "label": "{{_ingest._value.label.label}}"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.representativeFileSet",
        "target_field": "representative_file_set"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.rightsHolder",
        "target_field": "rights_holder"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.rightsStatement",
        "target_field": "rights_statement"
      }
    },
    {
      "remove": {
        "field": "rights_statement.scheme",
        "ignore_failure": true
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.scopeAndContents",
        "target_field": "scope_and_contents"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.series",
        "target_field": "series"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.source",
        "target_field": "source"
      }
    },
    {
      "rename": {
        "field": "original.administrativeMetadata.status.label",
        "target_field": "status",
        "on_failure": [
          {
            "set": {
              "field": "status",
              "value": ""
            }
          }
        ]
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.subject",
        "processor": {
          "append": {
            "field": "subject",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}",
              "role": "{{_ingest._value.role.label}}",
              "label_with_role": "{{_ingest._value.term.label}} ({{_ingest._value.role.label}})"
            }
          }
        }
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.stylePeriod",
        "processor": {
          "append": {
            "field": "style_period",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.tableOfContents",
        "target_field": "table_of_contents"
      }
    },
    {
      "foreach": {
        "field": "original.descriptiveMetadata.technique",
        "processor": {
          "append": {
            "field": "technique",
            "value": {
              "id": "{{_ingest._value.term.id}}",
              "label": "{{_ingest._value.term.label}}"
            }
          }
        }
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.termsOfUse",
        "target_field": "terms_of_use"
      }
    },
    {
      "rename": {
        "field": "original.thumbnail",
        "target_field": "thumbnail"
      }
    },
    {
      "rename": {
        "field": "original.descriptiveMetadata.title",
        "target_field": "title"
      }
    },
    {
      "rename": {
        "field": "original.visibility.label",
        "target_field": "visibility",
        "on_failure": [
          {
            "set": {
              "field": "visibility",
              "value": ""
            }
          }
        ]
      }
    },
    {
      "rename": {
        "field": "original.workType.label",
        "target_field": "work_type",
        "on_failure": [
          {
            "set": {
              "field": "work_type",
              "value": ""
            }
          }
        ]
      }
    },
    {
      "remove": {
        "field": "original"
      }
    }
  ]
}
